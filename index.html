<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會議邀請產生器</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #222;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="date"], input[type="time"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box; /* 確保 padding 不會影響寬度 */
            font-size: 16px;
        }
        input[readonly] {
            background-color: #e9e9e9;
            cursor: not-allowed;
        }
        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 5px;
            background-color: #FFC107; /* 您品牌的橘黃色 */
            color: #333; /* 深色文字確保可讀性 */
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #ffb300;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>建立會議邀請</h1>
        <form id="eventForm">
            <div class="form-group">
                <label for="title">主旨</label>
                <input type="text" id="title" placeholder="例如：寵心相伴｜文章討論" required>
            </div>
            <div class="form-group">
                <label for="date">日期</label>
                <input type="date" id="date" required>
            </div>
            <div class="form-group">
                <label for="startTime">開始時間</label>
                <input type="time" id="startTime" required>
            </div>
            <div class="form-group">
                <label for="endTime">結束時間</label>
                <input type="time" id="endTime" required>
            </div>
            <div class="form-group">
                <label for="meetingLink">會議連結</label>
                <input type="text" id="meetingLink" value="將由 Google 日曆自動產生" readonly>
            </div>
            
            <button type="button" id="submitButton">建立並傳送邀請</button>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // --- 步驟 1: 初始化 LIFF ---
            // ⭐⭐⭐ 請務必更換成您自己的 LIFF ID ⭐⭐⭐
            const myLiffId = "2007968447-PQ3LQjeO";
            
            liff.init({ liffId: myLiffId })
                .then(() => {
                    console.log("LIFF 初始化成功！");
                })
                .catch((err) => {
                    console.error("LIFF 初始化失敗", err);
                    alert("LIFF 初始化失敗，請檢查 LIFF ID 是否正確或重新開啟頁面。");
                });

            // --- 監聽按鈕點擊事件 ---
            const submitButton = document.getElementById("submitButton");
            submitButton.addEventListener("click", createAndShareEvent);
        });

        function createAndShareEvent() {
            // --- 步驟 2: 獲取表單資料 ---
            const title = document.getElementById('title').value;
            const date = document.getElementById('date').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;

            if (!title || !date || !startTime || !endTime) {
                alert("請填寫所有必填欄位！");
                return;
            }

            // --- 步驟 3: (未來) 呼叫後端服務以建立 Google 日曆行程 ---
            // 在我們完成後端服務之前，我們先模擬一個從後端拿到的會議連結
            console.log("正在模擬呼叫後端建立日曆行程...");
            const meetingLink = "https://meet.google.com/mock-link-for-now"; // 模擬的會議連結

            // --- 步驟 4: 檢查 shareTargetPicker 是否可用 ---
            if (!liff.isApiAvailable('shareTargetPicker')) {
                alert('您的 LINE 版本不支援分享功能，請更新至最新版本。');
                return;
            }

            // --- 步驟 5: 建立要分享的 Flex Message ---
            // 將日期格式轉換為更易讀的格式，例如 2025/08/21 (四)
            const eventDate = new Date(date);
            const weekDay = ['日', '一', '二', '三', '四', '五', '六'][eventDate.getDay()];
            const formattedDate = `${eventDate.getFullYear()}/${String(eventDate.getMonth() + 1).padStart(2, '0')}/${String(eventDate.getDate()).padStart(2, '0')} (${weekDay})`;
            const displayTime = `${startTime} - ${endTime}`;

            const flexMessage = {
                "type": "flex",
                "altText": `會議邀請：${title}`,
                "contents": {
                    "type": "bubble",
                    "header": {
                        "type": "box",
                        "layout": "vertical",
                        "paddingAll": "20px",
                        "backgroundColor": "#FFC107", // 品牌橘黃色
                        "contents": [
                            {
                                "type": "text",
                                "text": "會議預約確認",
                                "color": "#333333",
                                "size": "md",
                                "weight": "bold"
                            }
                        ]
                    },
                    "body": {
                        "type": "box",
                        "layout": "vertical",
                        "spacing": "md",
                        "contents": [
                            {
                                "type": "text",
                                "text": title,
                                "weight": "bold",
                                "size": "xl",
                                "wrap": true
                            },
                            {
                                "type": "box",
                                "layout": "vertical",
                                "margin": "lg",
                                "spacing": "sm",
                                "contents": [
                                    { "type": "separator" },
                                    {
                                        "type": "box",
                                        "layout": "baseline",
                                        "spacing": "sm",
                                        "margin": "md",
                                        "contents": [
                                            { "type": "text", "text": "時間", "color": "#aaaaaa", "size": "sm", "flex": 2 },
                                            { "type": "text", "text": `${formattedDate}\n${displayTime}`, "color": "#666666", "size": "sm", "flex": 5, "wrap": true }
                                        ]
                                    },
                                    { "type": "separator" }
                                ]
                            }
                        ]
                    },
                    "footer": {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                            {
                                "type": "button",
                                "style": "primary",
                                "action": { "type": "uri", "label": "開啟會議連結", "uri": meetingLink },
                                "color": "#FFC107" // 品牌橘黃色
                            }
                        ]
                    }
                }
            };
            
            // --- 步驟 6: 呼叫 shareTargetPicker 來分享訊息 ---
            liff.shareTargetPicker([flexMessage])
                .then(() => {
                    console.log("訊息分享成功");
                    liff.closeWindow(); // 分享成功後關閉 LIFF 視窗
                })
                .catch((error) => {
                    console.log("使用者取消分享或發生錯誤", error);
                });
        }
    </script>
</body>
</html>